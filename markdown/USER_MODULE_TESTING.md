# 🧪 用户申请模块测试指南

## 快速开始

### 前提条件
确保开发服务器正在运行：
```bash
cd venue-management-system
npm run dev
```

访问: http://localhost:5173

---

## 📝 测试场景 1: 发起新申请（完整流程）

### Step 1: 登录
1. 使用普通用户账号登录
   - 用户名: `user`
   - 密码: 任意（例如：`123456`）

### Step 2: 检查侧边栏菜单
**预期结果**:
- 应该看到 3 个菜单项：
  - ✅ 首页
  - ✅ 发起申请
  - ✅ 我的申请

### Step 3: 进入发起申请页面
1. 点击侧边栏的 **"发起申请"**
2. 应该看到一个表单，分为三个部分：
   - 活动信息
   - 场地预约
   - 物资借用

### Step 4: 填写活动信息
1. 在"活动名称"输入框输入: `学生会年度总结大会`

### Step 5: 选择场地
1. 点击"预约场地"下拉框
2. **预期结果**: 应该看到 3 个场地选项
   - 大学生活动中心 (A栋101, 容量200)
   - 体育馆 (B栋1楼, 容量500)
   - 露天广场 (校园中心, 容量1000)
   - ⚠️ 注意："多功能会议室"不应该出现（因为状态是"维修中"）
3. 选择: **体育馆**

### Step 6: 选择时间
1. 点击"预约时间"日期选择器
2. 选择明天的时间范围，例如:
   - 开始: 2025-10-26 14:00:00
   - 结束: 2025-10-26 17:00:00

### Step 7: 添加物资（动态表单测试）
1. 点击 **"添加物资"** 按钮
2. **预期结果**: 出现第一行物资输入
   - 一个下拉框（选择物资）
   - 一个数字输入框（数量）
   - 一个红色删除按钮

3. 在第一行：
   - 物资: 选择 **折叠椅 (库存200)**
   - 数量: 输入 `100`

4. 再次点击 **"添加物资"** 按钮
5. **预期结果**: 出现第二行物资输入

6. 在第二行：
   - 物资: 选择 **无线麦克风 (库存15)**
   - 数量: 输入 `3`

7. 再次点击 **"添加物资"** 按钮
8. 在第三行：
   - 物资: 选择 **投影仪 (库存8)**
   - 数量: 输入 `2`

9. 测试删除功能：
   - 点击第二行的删除按钮（红色圆形按钮）
   - **预期结果**: 第二行消失，只剩第一行和第三行

### Step 8: 提交申请
1. 点击 **"提交申请"** 按钮
2. **预期结果**:
   - 显示绿色提示 "申请提交成功！"
   - 自动跳转到"我的申请"页面

---

## 📋 测试场景 2: 查看我的申请

### Step 1: 验证跳转
- 应该已经在"我的申请"页面
- 页面标题显示 "我的申请"

### Step 2: 检查申请列表
**预期结果**: 应该看到 2 条申请

#### 申请 1（预置数据）:
- 申请ID: 1
- 活动名称: 迎新晚会彩排
- 场地名称: 大学生活动中心
- 开始时间: 2025-10-25 18:00:00
- 结束时间: 2025-10-25 21:00:00
- 状态: **已通过** (绿色标签)
- 借用物资: 
  - 折叠椅 × 100
  - 无线麦克风 × 2
- 操作: 取消申请 (可点击)

#### 申请 2（刚提交的）:
- 申请ID: 3
- 活动名称: 学生会年度总结大会
- 场地名称: 体育馆
- 开始时间: 2025-10-26 14:00:00
- 结束时间: 2025-10-26 17:00:00
- 状态: **待审核** (蓝色标签)
- 借用物资:
  - 折叠椅 × 100
  - 投影仪 × 2
- 操作: 取消申请 (可点击)

### Step 3: 验证数据关联
- 场地名称应该正确显示（不是ID）
- 物资名称应该正确显示（不是ID）

---

## ❌ 测试场景 3: 取消申请

### Step 1: 取消"待审核"的申请
1. 找到状态为 **"待审核"** 的申请（刚提交的那个）
2. 点击该行的 **"取消申请"** 按钮
3. **预期结果**: 弹出确认对话框
   - 标题: "提示"
   - 内容: "是否确认取消申请"学生会年度总结大会"？"
   - 按钮: 确认、取消

4. 点击 **"确认"** 按钮
5. **预期结果**:
   - 显示绿色提示 "申请已取消"
   - 该申请的状态变为 **"已取消"** (灰色标签)
   - "取消申请"按钮消失，显示 "-"

### Step 2: 验证不能再次取消
1. 查看刚才取消的申请
2. **预期结果**: 操作列显示 "-"，没有按钮

### Step 3: 取消"已通过"的申请
1. 找到状态为 **"已通过"** 的申请（迎新晚会彩排）
2. 点击 **"取消申请"** 按钮
3. 确认
4. **预期结果**: 状态变为 "已取消"

---

## 🔄 测试场景 4: 再次发起申请

### Step 1: 返回发起申请页面
1. 点击侧边栏的 **"发起申请"**
2. 或点击"我的申请"页面右上角的 **"发起新申请"** 按钮

### Step 2: 填写新申请
1. 活动名称: `社团文化节`
2. 场地: 选择 **露天广场**
3. 时间: 选择后天的某个时间段
4. 不添加任何物资（测试可选物资）
5. 点击 **"提交申请"**

### Step 3: 验证结果
1. 应该跳转到"我的申请"
2. 应该看到新申请（申请ID: 4）
3. 借用物资列应该显示 **"无"** (灰色文字)

---

## ✅ 测试场景 5: 表单验证

### Step 1: 测试必填项
1. 进入"发起申请"页面
2. 不填写任何内容
3. 直接点击 **"提交申请"**
4. **预期结果**:
   - 显示红色错误提示
   - "活动名称" 显示: "请输入活动名称"
   - "预约场地" 显示: "请选择场地"
   - "预约时间" 显示: "请选择预约时间"
   - 显示红色消息: "请填写完整的申请信息"

### Step 2: 测试活动名称长度
1. 在"活动名称"输入: `a` (只有1个字符)
2. 点击其他地方（失去焦点）
3. **预期结果**: 显示 "长度在 2 到 100 个字符"

### Step 3: 测试物资验证
1. 点击 **"添加物资"**
2. 不选择物资，直接点击 **"提交申请"**
3. **预期结果**: 物资选择框显示红色边框和错误提示

### Step 4: 测试重置功能
1. 填写部分表单
2. 点击 **"重置"** 按钮
3. **预期结果**:
   - 所有输入框清空
   - 物资列表清空
   - 验证错误消失

---

## 🔐 测试场景 6: 权限控制

### Step 1: 测试其他用户的申请不可见
1. 退出登录
2. 使用另一个用户名登录: `zhangsan`
3. 进入"我的申请"页面
4. **预期结果**: 
   - 只显示 "暂无申请记录"
   - 不显示 `user` 用户的申请

### Step 2: 测试管理员无法访问
1. 退出登录
2. 使用 `admin` 登录
3. 观察侧边栏
4. **预期结果**: 
   - 不显示 "发起申请" 和 "我的申请" 菜单
   - 只显示 "首页"、"场地管理"、"物资管理"

5. 尝试直接访问: `http://localhost:5173/apply/new`
6. **预期结果**: 被重定向到 403 页面

---

## 🔗 测试场景 7: 数据关联与同步

### Step 1: 测试场地数据同步
1. 使用 `admin` 登录
2. 进入"场地管理"
3. 新增一个场地: `新会议室`, 状态: `开放预约`
4. 退出登录
5. 使用 `user` 登录
6. 进入"发起申请"
7. 点击"预约场地"下拉框
8. **预期结果**: 应该看到刚才新增的 "新会议室"

### Step 2: 测试物资数据同步
1. 使用 `admin` 登录
2. 进入"物资管理"
3. 新增一个物资: `白板`, 分类: `其他`, 库存: `10`
4. 退出登录
5. 使用 `user` 登录
6. 进入"发起申请"
7. 点击"添加物资"
8. 点击物资下拉框
9. **预期结果**: 应该看到刚才新增的 "白板 (库存10)"

### Step 3: 测试维修中的场地不可选
1. 使用 `admin` 登录
2. 进入"场地管理"
3. 编辑 "体育馆"，将状态改为 **"维修中"**
4. 退出登录
5. 使用 `user` 登录
6. 进入"发起申请"
7. 点击"预约场地"下拉框
8. **预期结果**: "体育馆" 不应该出现在列表中

---

## 🎯 测试场景 8: 边界情况

### 测试 1: 添加大量物资
1. 进入"发起申请"
2. 连续点击"添加物资"10次
3. **预期结果**: 应该有10行物资输入，页面不应该崩溃
4. 删除所有物资行
5. **预期结果**: 物资列表为空

### 测试 2: 物资数量边界
1. 添加一个物资
2. 在数量输入框尝试输入 `0`
3. **预期结果**: 最小值应该是 1
4. 尝试输入 `999999`
5. **预期结果**: 应该可以输入（最大值10000）

### 测试 3: 时间选择
1. 选择一个过去的时间
2. **预期结果**: 应该可以选择（Mock数据不验证时间逻辑）
3. 选择开始时间晚于结束时间
4. **预期结果**: 日期选择器应该自动调整

### 测试 4: 空物资提交
1. 填写活动名称、场地、时间
2. 不添加任何物资
3. 点击"提交申请"
4. **预期结果**: 应该可以提交成功（物资是可选的）

---

## 📊 测试检查清单

### 发起申请页面
- [ ] 页面正确加载
- [ ] 活动名称输入正常
- [ ] 场地下拉框显示开放场地
- [ ] 场地下拉框不显示维修中的场地
- [ ] 时间选择器正常工作
- [ ] "添加物资"按钮正常
- [ ] 物资下拉框显示所有物资
- [ ] 数量输入框正常（最小值1）
- [ ] 删除物资按钮正常
- [ ] 表单验证生效
- [ ] "重置"按钮正常
- [ ] "提交申请"按钮正常
- [ ] 提交成功后跳转到"我的申请"

### 我的申请页面
- [ ] 页面正确加载
- [ ] 只显示当前用户的申请
- [ ] 场地名称正确显示（不是ID）
- [ ] 物资名称正确显示（不是ID）
- [ ] 状态标签颜色正确
  - [ ] 待审核 - 蓝色
  - [ ] 已通过 - 绿色
  - [ ] 未通过 - 红色
  - [ ] 已取消 - 灰色
- [ ] 物资列表正确显示
- [ ] 无物资时显示"无"
- [ ] "取消申请"按钮条件显示
- [ ] 取消申请功能正常
- [ ] 取消后状态更新
- [ ] 取消后按钮消失
- [ ] 空状态显示正常
- [ ] "发起新申请"按钮正常

### 数据同步
- [ ] 管理员新增场地后，用户能看到
- [ ] 管理员新增物资后，用户能看到
- [ ] 管理员修改场地状态后，用户选项更新
- [ ] 用户提交申请后，立即在列表中显示
- [ ] 用户取消申请后，状态立即更新

### 权限控制
- [ ] user 角色可以访问两个申请页面
- [ ] admin 角色无法访问申请页面
- [ ] reviewer 角色无法访问申请页面
- [ ] 直接访问URL被拦截
- [ ] 侧边栏菜单正确过滤

---

## 🐛 常见问题排查

### Q1: 提交申请后没有跳转？
**检查**:
- 打开浏览器控制台 (F12)
- 查看是否有 JavaScript 错误
- 确认表单验证通过（没有红色错误提示）

### Q2: "我的申请"页面是空的？
**检查**:
- 确认使用的是 `user` 账号登录
- 确认已经提交过申请
- 刷新页面后 Mock 数据会重置

### Q3: 场地下拉框是空的？
**检查**:
- 确认 `src/mock/data.js` 中有场地数据
- 确认至少有一个场地状态是"开放预约"
- 查看控制台是否有错误

### Q4: 添加物资按钮没反应？
**检查**:
- 查看控制台错误
- 确认 `materialList` 正确导入
- 尝试刷新页面

### Q5: 删除物资后表单验证报错？
**原因**: 
- 这是正常现象
- 删除物资项后，如果有验证错误，需要重新触发验证
**解决**: 点击"重置"按钮清除验证状态

---

## 🎉 测试完成

如果以上所有测试都通过，说明用户申请模块功能完全正常！

**关键功能验证**:
- ✅ 动态表单正常工作
- ✅ 数据关联正确
- ✅ 跨组件通信成功
- ✅ 权限控制生效
- ✅ 表单验证完善
- ✅ 用户体验良好

**下一步**: 可以开始开发审核员 (reviewer) 的审批功能了！

